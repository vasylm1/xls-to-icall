<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Class Schedule Converter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --accent: #4895ef;
      --light: #f8f9fa;
      --dark: #212529;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #dfe7f5 100%);
      color: var(--dark);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    h1, h2 {
      color: white;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    
    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .language-picker {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .language-picker select {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 2px solid var(--light);
      background: white;
      font-size: 1rem;
    }
    
    .toolbox {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      outline: none;
    }
    
    .btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      text-decoration: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    
    .btn-block {
      display: block;
      width: 100%;
    }
    
    .btn-success {
      background: linear-gradient(45deg, #2ecc71, #27ae60);
    }
    
    .about-content {
      line-height: 1.6;
    }
    
    .about-content p {
      margin-bottom: 1rem;
    }
    
    .social-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      background-color: rgba(67, 97, 238, 0.1);
      transition: all 0.3s ease;
    }
    
    .social-link:hover {
      background-color: rgba(67, 97, 238, 0.2);
      transform: translateY(-2px);
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .nav-container {
        flex-direction: column;
        align-items: stretch;
      }
      
      .toolbox {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="mainTitle">üìÖ Class Schedule Converter</h1>
    
    <div class="nav-container">
      <div class="language-picker">
        <label id="languageLabel">üåç Language:</label>
        <select id="languageSelect" onchange="setLanguage()">
          <option value="en">English</option>
          <option value="pl">Polski</option>
          <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
          <option value="tr">T√ºrk√ße</option>
          <option value="az">Az…ôrbaycanca</option>
        </select>
      </div>
    </div>

    <div class="toolbox">
      <div class="form-group">
        <label for="fileInput" id="fileLabel">Select your schedule file:</label>
        <input type="file" id="fileInput" class="form-control" accept=".xls,.xlsx">
      </div>
      
      <button onclick="convertToIcs()" class="btn btn-block" id="convertBtn">
        <i class="fas fa-exchange-alt"></i> <span id="convertText">Convert to Calendar</span>
      </button>
      
      <a id="downloadLink" class="btn btn-success btn-block" style="display: none; margin-top: 1rem;">
        <i class="fas fa-download"></i> <span id="downloadText">Download ICS File</span>
      </a>
    </div>

    <div class="toolbox">
      <div class="about-content">
        <h2 id="aboutTitle">About</h2>
        <p id="aboutText1">I'm a marketing professional with a background in office administration, technical support, and product marketing. I hold a Bachelor's degree in Marketing and am currently studying for my Master's in Marketing Management.</p>
        <p id="aboutText2">My work centers around supporting product launches, creating and maintaining marketing assets, and improving content quality using tools like Power BI, Excel, SAP, and Power Platform. I focus on practical solutions, clear communication, and making marketing more effective through technology.</p>
        <p id="aboutText3">I speak Ukrainian, Polish, English, and German, and I'm learning Spanish and Chinese. I enjoy working in international environments and collaborating across teams.</p>
        <p id="aboutText4">Outside of work, I'm passionate about travel, reading, exploring technology, staying active, and organizing events. I'm always looking to grow, improve, and take on new challenges.</p>
        <a href="https://www.linkedin.com/in/vasyl-madei-399488247/" target="_blank" class="social-link">
          <i class="fab fa-linkedin"></i>
          <span id="linkedinText">LinkedIn Profile</span>
        </a>
      </div>
    </div>
  </div>

  <script>
    // Translations
    const translations = {
      en: {
        mainTitle: "üìÖ Class Schedule Converter",
        languageLabel: "üåç Language:",
        fileLabel: "Select your schedule file:",
        convertText: "Convert to Calendar",
        downloadText: "Download ICS File",
        aboutTitle: "About",
        aboutText1: "I'm a marketing professional with a background in office administration, technical support, and product marketing. I hold a Bachelor's degree in Marketing and am currently studying for my Master's in Marketing Management.",
        aboutText2: "My work centers around supporting product launches, creating and maintaining marketing assets, and improving content quality using tools like Power BI, Excel, SAP, and Power Platform. I focus on practical solutions, clear communication, and making marketing more effective through technology.",
        aboutText3: "I speak Ukrainian, Polish, English, and German, and I'm learning Spanish and Chinese. I enjoy working in international environments and collaborating across teams.",
        aboutText4: "Outside of work, I'm passionate about travel, reading, exploring technology, staying active, and organizing events. I'm always looking to grow, improve, and take on new challenges.",
        linkedinText: "LinkedIn Profile",
        noFileError: "Please select a file first",
        fileError: "Error processing file: "
      },
      pl: {
        mainTitle: "üìÖ Konwerter Planu Zajƒôƒá",
        languageLabel: "üåç Jƒôzyk:",
        fileLabel: "Wybierz plik z planem zajƒôƒá:",
        convertText: "Konwertuj do Kalendarza",
        downloadText: "Pobierz plik ICS",
        aboutTitle: "O mnie",
        aboutText1: "Jestem specjalistƒÖ ds. marketingu z do≈õwiadczeniem w administracji biurowej, wsparciu technicznym oraz marketingu produktowym. Posiadam tytu≈Ç licencjata z marketingu i obecnie kontynuujƒô studia magisterskie na kierunku ZarzƒÖdzanie Marketingiem.",
        aboutText2: "Moja praca koncentruje siƒô na wsparciu wprowadzania produkt√≥w na rynek, tworzeniu i utrzymywaniu materia≈Ç√≥w marketingowych oraz poprawie jako≈õci tre≈õci przy u≈ºyciu narzƒôdzi takich jak Power BI, Excel, SAP i Power Platform. Skupiam siƒô na praktycznych rozwiƒÖzaniach, jasnej komunikacji i zwiƒôkszaniu efektywno≈õci marketingu poprzez technologiƒô.",
        aboutText3: "Pos≈Çugujƒô siƒô jƒôzykiem ukrai≈Ñskim, polskim, angielskim i niemieckim, a obecnie uczƒô siƒô r√≥wnie≈º hiszpa≈Ñskiego i chi≈Ñskiego. Ceniƒô sobie pracƒô w miƒôdzynarodowym ≈õrodowisku i wsp√≥≈Çpracƒô miƒôdzyzespo≈ÇowƒÖ.",
        aboutText4: "Poza pracƒÖ pasjonujƒô siƒô podr√≥≈ºami, czytaniem, nowymi technologiami, aktywnym stylem ≈ºycia oraz organizacjƒÖ wydarze≈Ñ. Zawsze dƒÖ≈ºƒô do rozwoju, samodoskonalenia i podejmowania nowych wyzwa≈Ñ.",
        linkedinText: "Profil LinkedIn",
        noFileError: "Proszƒô wybraƒá plik",
        fileError: "B≈ÇƒÖd przetwarzania pliku: "
      },
      uk: {
        mainTitle: "üìÖ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –†–æ–∑–∫–ª–∞–¥—É –ó–∞–Ω—è—Ç—å",
        languageLabel: "üåç –ú–æ–≤–∞:",
        fileLabel: "–í–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª –∑ —Ä–æ–∑–∫–ª–∞–¥–æ–º:",
        convertText: "–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ –≤ –ö–∞–ª–µ–Ω–¥–∞—Ä",
        downloadText: "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª ICS",
        aboutTitle: "–ü—Ä–æ –º–µ–Ω–µ",
        aboutText1: "–Ø –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ —ñ–∑ –¥–æ—Å–≤—ñ–¥–æ–º —É —Å—Ñ–µ—Ä—ñ –æ—Ñ—ñ—Å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è, —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É. –ú–∞—é —Å—Ç—É–ø—ñ–Ω—å –±–∞–∫–∞–ª–∞–≤—Ä–∞ –∑ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É —Ç–∞ –Ω–∞—Ä–∞–∑—ñ –∑–¥–æ–±—É–≤–∞—é –º–∞–≥—ñ—Å—Ç–µ—Ä—Å—å–∫—É –æ—Å–≤—ñ—Ç—É –∑–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—é ¬´–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∏–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç¬ª.",
        aboutText2: "–ú–æ—è —Ä–æ–±–æ—Ç–∞ –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∞ –Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ –∑–∞–ø—É—Å–∫—ñ–≤ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ —Ç–∞ —Å—É–ø—Ä–æ–≤–æ–¥—ñ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤, –∞ —Ç–∞–∫–æ–∂ –Ω–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—ñ —è–∫–æ—Å—Ç—ñ –∫–æ–Ω—Ç–µ–Ω—Ç—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ Power BI, Excel, SAP —Ç–∞ Power Platform. –Ø —Ä–æ–±–ª—é –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–Ω–∏—Ö —Ä—ñ—à–µ–Ω–Ω—è—Ö, —á—ñ—Ç–∫–æ–º—É —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—ñ —Ç–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó.",
        aboutText3: "–í–æ–ª–æ–¥—ñ—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é, –ø–æ–ª—å—Å—å–∫–æ—é, –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é —Ç–∞ –Ω—ñ–º–µ—Ü—å–∫–æ—é –º–æ–≤–∞–º–∏, –∞ —Ç–∞–∫–æ–∂ –≤–∏–≤—á–∞—é —ñ—Å–ø–∞–Ω—Å—å–∫—É —Ç–∞ –∫–∏—Ç–∞–π—Å—å–∫—É. –ú–µ–Ω—ñ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ —Ç–∞ —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.",
        aboutText4: "–£ –≤—ñ–ª—å–Ω–∏–π —á–∞—Å –∑–∞—Ö–æ–ø–ª—é—é—Å—è –ø–æ–¥–æ—Ä–æ–∂–∞–º–∏, —á–∏—Ç–∞–Ω–Ω—è–º, –Ω–æ–≤–∏–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è–º–∏, —Å–ø–æ—Ä—Ç–æ–º —ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—î—é –∑–∞—Ö–æ–¥—ñ–≤. –Ø –∑–∞–≤–∂–¥–∏ –ø—Ä–∞–≥–Ω—É –¥–æ —Å–∞–º–æ—Ä–æ–∑–≤–∏—Ç–∫—É, –≤–¥–æ—Å–∫–æ–Ω–∞–ª–µ–Ω–Ω—è —Ç–∞ –Ω–æ–≤–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.",
        linkedinText: "–ü—Ä–æ—Ñ—ñ–ª—å LinkedIn",
        noFileError: "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª",
        fileError: "–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ —Ñ–∞–π–ª—É: "
      },
      tr: {
        mainTitle: "üìÖ Ders Programƒ± D√∂n√º≈üt√ºr√ºc√º",
        languageLabel: "üåç Dil:",
        fileLabel: "Ders programƒ± dosyasƒ± se√ßin:",
        convertText: "Takvime D√∂n√º≈üt√ºr",
        downloadText: "ICS Dosyasƒ±nƒ± ƒ∞ndir",
        aboutTitle: "Hakkƒ±mda",
        aboutText1: "Ofis y√∂netimi, teknik destek ve √ºr√ºn pazarlama ge√ßmi≈üine sahip bir pazarlama profesyoneliyim. Pazarlama alanƒ±nda lisans derecesine sahibim ve ≈üu anda Pazarlama Y√∂netimi alanƒ±nda y√ºksek lisans yapmaktayƒ±m.",
        aboutText2: "√áalƒ±≈ümalarƒ±m, √ºr√ºn lansmanlarƒ±nƒ± desteklemeye, pazarlama materyalleri olu≈üturmaya ve Power BI, Excel, SAP ve Power Platform gibi ara√ßlarƒ± kullanarak i√ßerik kalitesini artƒ±rmaya odaklanƒ±yor. Pratik √ß√∂z√ºmler, net ileti≈üim ve teknoloji yoluyla pazarlamayƒ± daha etkili hale getirmeye √∂nem veriyorum.",
        aboutText3: "Ukraynaca, Leh√ße, ƒ∞ngilizce ve Almanca biliyorum ve ≈üu anda ƒ∞spanyolca ve √áince √∂ƒüreniyorum. Uluslararasƒ± ortamlarda √ßalƒ±≈ümayƒ± ve ekipler arasƒ± i≈übirliƒüini seviyorum.",
        aboutText4: "ƒ∞≈ü dƒ±≈üƒ±nda seyahat etmek, okumak, teknolojiyi ke≈üfetmek, aktif kalmak ve etkinlikler d√ºzenlemek benim tutkularƒ±m arasƒ±nda. S√ºrekli olarak kendimi geli≈ütirmeye, iyile≈ütirmeye ve yeni zorluklar √ºstlenmeye hevesliyim.",
        linkedinText: "LinkedIn Profili",
        noFileError: "L√ºtfen bir dosya se√ßin",
        fileError: "Dosya i≈üleme hatasƒ±: "
      },
      az: {
        mainTitle: "üìÖ D…ôrs C…ôdv…ôli Konvertoru",
        languageLabel: "üåç Dil:",
        fileLabel: "D…ôrs c…ôdv…ôli faylƒ±nƒ± se√ßin:",
        convertText: "T…ôqvim…ô √ßevir",
        downloadText: "ICS Faylƒ±nƒ± Y√ºkl…ô",
        aboutTitle: "Haqqƒ±mda",
        aboutText1: "Ofis administrasiyasƒ±, texniki d…ôst…ôk v…ô m…ôhsul marketinqi t…ôcr√ºb…ôsi olan marketinq pe≈ü…ôkaran. Marketinq √ºzr…ô bakalavr d…ôr…ôc…ôsin…ô sahib…ôm v…ô hazƒ±rda Marketinq Menecmenti √ºzr…ô magistr t…ôhsili alƒ±ram.",
        aboutText2: "ƒ∞≈üim m…ôhsul buraxƒ±lƒ±≈ülarƒ±nƒ± d…ôst…ôkl…ôm…ôk, marketinq materiallarƒ± yaratmaq v…ô Power BI, Excel, SAP v…ô Power Platform kimi al…ôtl…ôrd…ôn istifad…ô ed…ôr…ôk m…ôzmun keyfiyy…ôtini yax≈üƒ±la≈üdƒ±rmaq √ºz…ôrind…ô c…ôml…ônib. Praktik h…ôll…ôr, aydƒ±n √ºnsiyy…ôt v…ô texnologiya vasit…ôsil…ô marketinqi daha effektiv etm…ôy…ô diqq…ôt yetirir…ôm.",
        aboutText3: "Ukrayna, polyak, ingilis v…ô alman dill…ôrind…ô danƒ±≈üƒ±ram v…ô hazƒ±rda ispan v…ô √ßin dill…ôrini √∂yr…ônir…ôm. Beyn…ôlxalq m√ºhitd…ô i≈ül…ôm…ôyi v…ô komandalar arasƒ±nda …ôm…ôkda≈ülƒ±q etm…ôyi sevir…ôm.",
        aboutText4: "ƒ∞≈üd…ôn k…ônarda s…ôyah…ôt, oxumaq, texnologiyalarƒ± ara≈üdƒ±rmaq, f…ôal qalmaq v…ô t…ôdbirl…ôr t…ô≈ükil etm…ôk maraqlarƒ±mdƒ±r. Daim inki≈üaf etm…ôy…ô, √∂z√ºm√º t…ôkmill…ô≈üdirm…ôy…ô v…ô yeni √ßaƒüƒ±rƒ±≈ülar q…ôbul etm…ôy…ô √ßalƒ±≈üƒ±ram.",
        linkedinText: "LinkedIn Profili",
        noFileError: "Z…ôhm…ôt olmasa bir fayl se√ßin",
        fileError: "Fayl emalƒ± x…ôtasƒ±: "
      }
    };

    // Set language
    function setLanguage() {
      const lang = document.getElementById("languageSelect").value;
      const t = translations[lang];
      
      document.getElementById("mainTitle").textContent = t.mainTitle;
      document.getElementById("languageLabel").textContent = t.languageLabel;
      document.getElementById("fileLabel").textContent = t.fileLabel;
      document.getElementById("convertText").textContent = t.convertText;
      document.getElementById("downloadText").textContent = t.downloadText;
      document.getElementById("aboutTitle").textContent = t.aboutTitle;
      document.getElementById("aboutText1").textContent = t.aboutText1;
      document.getElementById("aboutText2").textContent = t.aboutText2;
      document.getElementById("aboutText3").textContent = t.aboutText3;
      document.getElementById("aboutText4").textContent = t.aboutText4;
      document.getElementById("linkedinText").textContent = t.linkedinText;
    }

    /**
     * Converts Excel file to iCal format using local time
     */
    function convertToIcs() {
      const lang = document.getElementById("languageSelect").value;
      const t = translations[lang];
      const fileInput = document.getElementById('fileInput');
      
      if (!fileInput.files.length) {
        alert(t.noFileError);
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          // Parse Excel file
          const data = new Uint8Array(e.target.result);
          const wb = XLSX.read(data, { type: 'array' });
          const ws = wb.Sheets[wb.SheetNames[0]];
          const json = XLSX.utils.sheet_to_json(ws, { header: 1 });

          // Generate iCal content
          let icsContent = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//Class Schedule Converter//EN",
            "CALSCALE:GREGORIAN"
          ].join("\n");

          // Process each row (skip header)
          for (let i = 1; i < json.length; i++) {
            const row = json[i];
            if (!row[0]) continue; // Skip empty rows

            // Map columns (A=0, B=1, etc.)
            const startDate = formatDate(row[0]); // Column A: Start date (data rozpoczƒôcia)
            const endDate = formatDate(row[1] || row[0]); // Column B: End date (data zako≈Ñczenia)
            const subjectName = row[4] || ""; // Column E: Event description (nazwa pe≈Çna przedmiotu)
            
            // Combine additional fields into comment (ignoring "godziny planowane")
            // Columns: F=group, G=lecturer, H=stage type, I=dean's groups, J=room, K=status
            const comment = [
              `Group: ${row[5] || ""}`,
              `Lecturer: ${row[6] || ""}`,
              `Room: ${row[9] || ""}`,
              row[10] && `Status: ${row[10]}`
            ].filter(Boolean).join("\\n");

            if (!startDate) {
              console.warn(`Skipping row ${i+1}: Invalid start date`);
              continue;
            }

            // Add event to iCal (using local time)
            icsContent += [
              "\nBEGIN:VEVENT",
              `DTSTART:${startDate}`,
              `DTEND:${endDate}`,
              `SUMMARY:${escapeIcalText(subjectName)}`,
              comment && `DESCRIPTION:${escapeIcalText(comment)}`,
              "END:VEVENT"
            ].filter(Boolean).join("\n");
          }

          icsContent += "\nEND:VCALENDAR";

          // Create download link
          const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
          const link = document.getElementById('downloadLink');
          link.href = URL.createObjectURL(blob);
          link.download = 'class_schedule.ics';
          link.style.display = 'block';
        } catch (error) {
          alert(t.fileError + error.message);
          console.error(error);
        }
      };
      reader.onerror = function() {
        alert(t.fileError);
      };
      reader.readAsArrayBuffer(fileInput.files[0]);
    }

    /**
     * Formats date for iCal in local time (YYYYMMDDTHHMMSS)
     * Handles Polish date format: DD.MM.YYYY HH:mm
     */
    function formatDate(dateStr) {
      if (!dateStr) return '';

      let date;
      
      // Handle Polish date format: "DD.MM.YYYY HH:mm"
      if (typeof dateStr === 'string') {
        const polishDate = dateStr.match(/(\d{2})\.(\d{2})\.(\d{4}) (\d{2}):(\d{2})/);
        if (polishDate) {
          const [_, day, month, year, hours, minutes] = polishDate;
          date = new Date(`${year}-${month}-${day}T${hours}:${minutes}:00`);
        } else {
          // Fallback to JS Date parsing
          date = new Date(dateStr);
        }
      }
      // Handle Excel serial numbers
      else if (typeof dateStr === 'number') {
        date = new Date((dateStr - 25569) * 86400 * 1000);
      }
      // Handle JS Date objects
      else if (dateStr instanceof Date) {
        date = dateStr;
      }

      // Validate
      if (!date || isNaN(date.getTime())) {
        console.warn('Invalid date format:', dateStr);
        return '';
      }

      // Format in local time (no UTC conversion)
      const pad = n => n.toString().padStart(2, '0');
      return [
        date.getFullYear(),
        pad(date.getMonth() + 1),
        pad(date.getDate()),
        'T',
        pad(date.getHours()),
        pad(date.getMinutes()),
        pad(date.getSeconds())
      ].join('');
    }

    /**
     * Escapes text for iCal (commas, semicolons, newlines)
     */
    function escapeIcalText(text) {
      return String(text)
        .replace(/\\/g, '\\\\')
        .replace(/,/g, '\\,')
        .replace(/;/g, '\\;')
        .replace(/\n/g, '\\n');
    }

    // Initialize
    window.onload = function() {
      // Set browser language or default to English
      const browserLang = navigator.language.slice(0, 2);
      const supportedLangs = Object.keys(translations);
      const defaultLang = supportedLangs.includes(browserLang) ? browserLang : 'en';
      document.getElementById("languageSelect").value = defaultLang;
      setLanguage();
    };
  </script>
</body>
</html>